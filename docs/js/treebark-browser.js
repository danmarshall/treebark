(function(h,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(h=typeof globalThis<"u"?globalThis:h||self,g(h.Treebark={}))})(this,(function(h){"use strict";const g=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a","comment"]),$=new Set(["img"]),O=new Set([...g,...$]),D=new Set(["id","class","style","title","role","data-","aria-"]),W={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])};function T(e,t){return t.split(".").reduce((r,i)=>r&&typeof r=="object"&&r!==null?r[i]:void 0,e)}function _(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]||t)}function S(e,t,r=!0){return e.replace(/(\{\{\{|\{\{)(.*?)(\}\}\}|\}\})/g,(i,n,o,c)=>{const u=o.trim();if(n==="{{{")return`{{${u}}}`;const d=T(t,u);return d==null?"":r?_(String(d)):String(d)})}function G(e,t){const r=D.has(e)||[...D].some(o=>o.endsWith("-")&&e.startsWith(o)),i=W[t],n=i&&i.has(e);if(!r&&!n)throw new Error(`Attribute "${e}" is not allowed on tag "${t}"`)}function N(e){return e!==null&&typeof e=="object"&&"$template"in e}function I(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$bind"in e}function R(e){const t=Object.entries(e);if(t.length===0)throw new Error("Schema object must have at least one tag");const r=t[0];if(!r)throw new Error("Schema object must have at least one tag");const[i,n]=r,o=typeof n=="string"?[n]:Array.isArray(n)?n:n?.$children||[],c=n&&typeof n=="object"&&!Array.isArray(n)?Object.fromEntries(Object.entries(n).filter(([u])=>u!=="$children")):{};return{tag:i,rest:n,children:o,attrs:c}}function E(e,t={}){const r=t.data||{};if(N(e))return E(e.$template,{data:e.$data,indent:t.indent});const i=t.indent?{indentStr:typeof t.indent=="number"?" ".repeat(t.indent):typeof t.indent=="string"?t.indent:"  ",level:0}:{};return A(e,r,i)}function V(e,t,r,i,n,o){if(e==="comment")return`<!--${i||""}-->`;const c=`<${e}${q(t,r,e)}>`;if($.has(e))return c;if(n&&i&&i.includes("<")){const d=n.repeat(o||0);return`${c}
${i}
${d}</${e}>`}return`${c}${i||""}</${e}>`}function A(e,t,r={}){if(typeof e=="string")return S(e,t);const i=r.indentStr?`
`:"";if(Array.isArray(e))return e.map(s=>A(s,t,r)).join(i);const{tag:n,rest:o,children:c,attrs:u}=R(e);if(!O.has(n))throw new Error(`Tag "${n}" is not allowed`);if(n==="comment"&&r.insideComment)throw new Error("Nested comments are not allowed");const d=c.length>0,f=$.has(n);if(f&&d)throw new Error(`Tag "${n}" is a void element and cannot have children`);const a={...r,insideComment:n==="comment"||r.insideComment,level:(r.level||0)+1};if(I(o)){const s=T(t,o.$bind),{$bind:m,$children:y=[],...p}=o;if(f&&y.length>0)throw new Error(`Tag "${n}" is a void element and cannot have children`);if(Array.isArray(s)){const v=s.map(b=>y.map(C=>A(C,b,a)).join(i)).join(i);return V(n,p,t,v,r.indentStr,r.level)}const j=s&&typeof s=="object"&&s!==null?s:{};return A({[n]:{...p,$children:y}},j,r)}const l=c.map(s=>{const m=A(s,t,a);return r.indentStr&&m.startsWith("<")?r.indentStr.repeat(a.level)+m:m}).join(i);return V(n,u,t,l,r.indentStr,r.level)}function q(e,t,r){const i=Object.entries(e).filter(([n])=>(G(n,r),!0)).map(([n,o])=>`${n}="${_(S(String(o),t,!1))}"`).join(" ");return i?" "+i:""}function L(e,t={}){const r=t.data||{};if(N(e))return L(e.$template,{data:e.$data});const i=document.createDocumentFragment(),n=w(e,r,{});return Array.isArray(n)?n.forEach(o=>i.appendChild(o)):i.appendChild(n),i}function w(e,t,r={}){if(typeof e=="string")return document.createTextNode(S(e,t));if(Array.isArray(e))return e.flatMap(a=>{const l=w(a,t,r);return Array.isArray(l)?l:[l]});const{tag:i,rest:n,children:o,attrs:c}=R(e);if(!O.has(i))throw new Error(`Tag "${i}" is not allowed`);if(i==="comment"&&r.insideComment)throw new Error("Nested comments are not allowed");const u=o.length>0,d=$.has(i);if(d&&u)throw new Error(`Tag "${i}" is a void element and cannot have children`);if(i==="comment"){const l=E(e,{data:t}).slice(4,-3);return document.createComment(l)}const f=document.createElement(i);if(I(n)){const a=T(t,n.$bind),{$bind:l,$children:s=[],...m}=n;if(M(f,m,t,i),d&&s.length>0)throw new Error(`Tag "${i}" is a void element and cannot have children`);if(Array.isArray(a))return a.forEach(j=>s.forEach(v=>{const b=w(v,j,r);(Array.isArray(b)?b:[b]).forEach(C=>f.appendChild(C))})),f;const y=a&&typeof a=="object"&&a!==null?a:{},p=w({[i]:{...m,$children:s}},y,r);return Array.isArray(p)?p:[p]}return M(f,c,t,i),o.forEach(a=>{const l=w(a,t,r);(Array.isArray(l)?l:[l]).forEach(s=>f.appendChild(s))}),f}function M(e,t,r,i){Object.entries(t).forEach(([n,o])=>{G(n,i),e.setAttribute(n,S(String(o),r,!1))})}h.renderToDOM=L,h.renderToString=E,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=treebark-browser.js.map
