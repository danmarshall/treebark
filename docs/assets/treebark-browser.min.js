(function(p,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(p=typeof globalThis<"u"?globalThis:p||self,h(p.Treebark={}))})(this,(function(p){"use strict";const h=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a"]),W=new Set(["$comment","$if"]),m=new Set(["img","br","hr"]),_=new Set([...h,...W,...m]),T=new Set(["id","class","style","title","role","data-","aria-"]),D={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])},C=new Set(["$<","$>","$<=","$>=","$=","$in"]),O=new Set(["$check","$then","$else","$not","$join",...C]),G=new Set(["display","position","top","right","bottom","left","z-index","float","clear","overflow","overflow-x","overflow-y","visibility","width","height","min-width","min-height","max-width","max-height","margin","margin-top","margin-right","margin-bottom","margin-left","padding","padding-top","padding-right","padding-bottom","padding-left","box-sizing","border","border-width","border-style","border-color","border-radius","border-top","border-right","border-bottom","border-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","outline","outline-width","outline-style","outline-color","outline-offset","background","background-color","background-position","background-size","background-repeat","background-attachment","background-clip","background-origin","color","font","font-family","font-size","font-weight","font-style","font-variant","line-height","letter-spacing","word-spacing","text-align","text-decoration","text-indent","text-transform","text-shadow","text-overflow","white-space","word-wrap","word-break","vertical-align","direction","unicode-bidi","list-style","list-style-type","list-style-position","border-collapse","border-spacing","caption-side","empty-cells","table-layout","flex","flex-direction","flex-wrap","flex-flow","justify-content","align-items","align-content","align-self","flex-grow","flex-shrink","flex-basis","order","gap","row-gap","column-gap","grid","grid-template","grid-template-columns","grid-template-rows","grid-template-areas","grid-column","grid-row","grid-area","grid-auto-columns","grid-auto-rows","grid-auto-flow","grid-column-start","grid-column-end","grid-row-start","grid-row-end","transform","transform-origin","transition","transition-property","transition-duration","transition-timing-function","transition-delay","animation","animation-name","animation-duration","animation-timing-function","animation-delay","animation-iteration-count","animation-direction","animation-fill-mode","animation-play-state","opacity","box-shadow","filter","backdrop-filter","cursor","pointer-events","resize","user-select","content","quotes","counter-reset","counter-increment","object-fit","object-position"]);function y(t,n,i=[],r){if(n===".")return t;let o=t,s=n;for(;s.startsWith("..");){let e=0,a=s;for(;a.startsWith("..");)e++,a=a.substring(2),a.startsWith("/")&&(a=a.substring(1));if(e<=i.length)o=i[i.length-e],s=a.startsWith(".")?a.substring(1):a;else return}if(s){if(r&&typeof o!="object"&&o!==null&&o!==void 0){r.error(`Cannot access property "${s}" on primitive value of type "${typeof o}"`);return}return s.split(".").reduce((e,a)=>e&&typeof e=="object"&&e!==null?e[a]:void 0,o)}return o}function k(t){return t.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[n]||n)}function g(t,n,i=!0,r=[],o){return t.replace(/\{\{\{([^{]*?)\}\}\}|\{\{([^{]*?)\}\}/g,(s,e,a)=>{if(e!==void 0)return`{{${e.trim()}}}`;const c=a.trim(),d=y(n,c,r,o);return d==null?"":i?k(String(d)):String(d)})}function z(t){return t.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`)}function q(t,n){const i=[];for(const[r,o]of Object.entries(t)){const s=z(r);if(!G.has(s)){n.warn(`CSS property "${r}" (${s}) is not in the allowed list`);continue}if(o==null)continue;const e=String(o).trim();if(/url\s*\(/i.test(e)||/expression\s*\(/i.test(e)||/javascript:/i.test(e)||/@import/i.test(e)){n.warn(`CSS value for "${r}" contains potentially dangerous pattern: "${e}"`);continue}i.push(`${s}: ${e}`)}return i.join("; ")}function R(t,n,i,r){if(P(t)){const o=E(t,n,i,r);return R(o,n,i,r)}return typeof t=="object"&&t!==null&&!Array.isArray(t)?q(t,r):(r.error(`Style attribute must be an object with CSS properties, not ${typeof t}. Example: style: { color: "red", fontSize: "14px" }`),"")}function N(t,n,i){const r=T.has(t)||[...T].some(e=>e.endsWith("-")&&t.startsWith(e)),o=D[n],s=o&&o.has(t);return!r&&!s?(i.warn(`Attribute "${t}" is not allowed on tag "${n}"`),!1):!0}function K(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"$bind"in t}function w(t,n,i){return t==="."?!0:t.includes("..")?(i.error(`${n} does not support parent context access (..) - use interpolation {{..prop}} in content/attributes instead. Invalid: ${n}: "${t}"`),!1):t.includes("{{")?(i.error(`${n} does not support interpolation {{...}} - use literal property paths only. Invalid: ${n}: "${t}"`),!1):!0}function x(t,n){const i=[];for(const e of C)e in n&&i.push({key:e,value:n[e]});if(i.length===0){const e=!!t;return n.$not?!e:e}const r=i.map(e=>{switch(e.key){case"$<":return typeof t=="number"&&typeof e.value=="number"&&t<e.value;case"$>":return typeof t=="number"&&typeof e.value=="number"&&t>e.value;case"$<=":return typeof t=="number"&&typeof e.value=="number"&&t<=e.value;case"$>=":return typeof t=="number"&&typeof e.value=="number"&&t>=e.value;case"$=":return t===e.value;case"$in":return Array.isArray(e.value)&&e.value.includes(t);default:return!1}}),o=n.$join==="OR";let s;return o?s=r.some(e=>e):s=r.every(e=>e),n.$not?!s:s}function P(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"$check"in t&&typeof t.$check=="string"}function E(t,n,i=[],r){if(!w(t.$check,"$check",r))return"";const o=y(n,t.$check,i);return x(o,t)?t.$then!==void 0?t.$then:"":t.$else!==void 0?t.$else:""}function B(t,n){if(!t||typeof t!="object"){n.error("Template object cannot be null, undefined, or non-object");return}const i=Object.entries(t);if(i.length===0){n.error("Template object must have at least one tag");return}const r=i[0];if(!r){n.error("Template object must have at least one tag");return}const[o,s]=r,e=typeof s=="string"?[s]:Array.isArray(s)?s:s?.$children||[],a=s&&typeof s=="object"&&!Array.isArray(s)?Object.fromEntries(Object.entries(s).filter(([c])=>c!=="$children")):{};return{tag:o,rest:s,children:e,attrs:a}}function F(t,n,i=[],r){const o=t;if(!o.$check)return r.error('"$if" tag requires $check attribute to specify the condition'),{valueToRender:void 0};if(!w(o.$check,"$check",r))return{valueToRender:void 0};const s=y(n,o.$check,i);typeof t=="object"&&t!==null&&!Array.isArray(t)&&"$children"in t&&r.warn('"$if" tag does not support $children, use $then and $else instead');const{$then:e,$else:a}=o;if(e!==void 0&&Array.isArray(e))return r.error('"$if" tag $then must be a string or single element object, not an array'),{valueToRender:void 0};if(a!==void 0&&Array.isArray(a))return r.error('"$if" tag $else must be a string or single element object, not an array'),{valueToRender:void 0};const d=(typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.keys(t):[]).filter(f=>!O.has(f));return d.length>0&&r.warn(`"$if" tag does not support attributes: ${d.join(", ")}. Allowed: ${[...O].join(", ")}`),{valueToRender:x(s,o)?e:a}}const M=(t,n)=>{if(!n)return t.length<=1?t[0]?.[1]??"":t.reduce((r,[,o])=>r+o,"");if(t.length===0)return"";if(t.length===1&&!t[0][1].includes("<"))return t[0][1];let i=`
`;for(let r=0;r<t.length;r++)i+=n.repeat(t[r][0])+t[r][1],r<t.length-1&&(i+=`
`);return i+=`
`,i};function Y(t,n={}){const i=t.data,r=n.logger||console,o=n.indent?{indentStr:typeof n.indent=="number"?" ".repeat(n.indent):typeof n.indent=="string"?n.indent:"  ",level:0,logger:r}:{logger:r};return b(t.template,i,o)}function Z(t,n,i,r,o,s,e,a=[]){const c=M(r,s),d=c.startsWith(`
`)&&s?s.repeat(e||0):"";if(t==="$comment")return`<!--${c}${d}-->`;const u=`<${t}${H(n,i,t,a,o)}>`;return m.has(t)?u:`${u}${c}${d}</${t}>`}function b(t,n,i){const r=i.parents||[],o=i.logger;if(typeof t=="string")return g(t,n,!0,r,o);if(Array.isArray(t))return t.map(l=>b(l,n,i)).join(i.indentStr?`
`:"");const s=B(t,o);if(!s)return"";const{tag:e,rest:a,children:c,attrs:d}=s;if(!_.has(e))return o.error(`Tag "${e}" is not allowed`),"";if(e==="$comment"&&i.insideComment)return o.error("Nested comments are not allowed"),"";if(e==="$if"){const{valueToRender:l}=F(a,n,r,o);return l===void 0?"":b(l,n,i)}m.has(e)&&c.length>0&&o.warn(`Tag "${e}" is a void element and cannot have children`);const u={...i,insideComment:e==="$comment"||i.insideComment,level:(i.level||0)+1},v=l=>l===""?[]:i.indentStr&&l.includes(`
`)&&!l.includes("<")?l.split(`
`).map($=>[u.level,$]):[[u.level,l]];let f,A;if(K(a)){if(!w(a.$bind,"$bind",o))return"";const l=y(n,a.$bind,[],o),{$bind:$,$children:I=[],...L}=a;if(!Array.isArray(l)){if(l!=null&&typeof l!="object")return o.error(`$bind resolved to primitive value of type "${typeof l}", cannot render children`),"";const S=l&&typeof l=="object"&&l!==null?l:{},j=[...r,n];return b({[e]:{...L,$children:I}},S,{...i,parents:j})}if(f=[],!m.has(e))for(const S of l){const j=[...r,n];for(const J of I){const Q=b(J,S,{...u,parents:j});f.push(...v(Q))}}A=L}else{if(f=[],!m.has(e))for(const l of c){const $=b(l,n,{...u,parents:r});f.push(...v($))}A=d}return Z(e,A,n,f,o,i.indentStr,i.level,r)}function H(t,n,i,r=[],o){const s=Object.entries(t).filter(([e])=>N(e,i,o)).map(([e,a])=>{let c;if(e==="style"){if(c=R(a,n,r,o),!c)return null}else if(P(a)){const d=E(a,n,r,o);c=g(String(d),n,!1,r,o)}else c=g(String(a),n,!1,r,o);return`${e}="${k(c)}"`}).filter(e=>e!==null).join(" ");return s?" "+s:""}p.renderToString=Y,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=treebark-browser.min.js.map
