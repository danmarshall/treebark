(function(h,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(h=typeof globalThis<"u"?globalThis:h||self,m(h.Treebark={}))})(this,(function(h){"use strict";const m=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a"]),W=new Set(["$comment","$if"]),b=new Set(["img","br","hr"]),G=new Set([...m,...W,...b]),O=new Set(["id","class","style","title","role","data-","aria-"]),z={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])},R=new Set(["$<","$>","$<=","$>=","$=","$in"]),E=new Set(["$check","$then","$else","$not","$join",...R]),N=new Set(["behavior","-moz-binding"]);function y(e,t,o=[],r,s){if(t===".")return e;let i=e,n=t;for(;n.startsWith("..");){let l=0,c=n;for(;c.startsWith("..");)l++,c=c.substring(2),c.startsWith("/")&&(c=c.substring(1));if(l<=o.length)i=o[o.length-l],n=c.startsWith(".")?c.substring(1):c;else return s?s(t,e,o):void 0}if(n){if(r&&typeof i!="object"&&i!==null&&i!==void 0){r.error(`Cannot access property "${n}" on primitive value of type "${typeof i}"`);return}const l=n.split(".").reduce((c,u)=>c&&typeof c=="object"&&c!==null?c[u]:void 0,i);return l===void 0&&s?s(t,e,o):l}return i}function I(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]||t)}function w(e,t,o=!0,r=[],s,i){return e.replace(/\{\{\{([^{]*?)\}\}\}|\{\{([^{]*?)\}\}/g,(n,l,c)=>{if(l!==void 0)return`{{${l.trim()}}}`;const u=c.trim(),f=y(t,u,r,s,i);return f==null?"":o?I(String(f)):String(f)})}function P(e,t){const o=[];for(const[r,s]of Object.entries(e)){const i=r;if(!/^[a-z]([a-z0-9-]*[a-z0-9])?$/.test(i)){t.warn(`CSS property "${r}" has invalid format (must be kebab-case)`);continue}if(N.has(i)){t.warn(`CSS property "${r}" is blocked for security reasons`);continue}if(s==null)continue;let n=String(s).trim();if(n.includes(";")){const u=n;n=n.split(";")[0].trim(),n&&n!==u.trim()&&t.warn(`CSS value for "${r}" contained semicolon - using only first part: "${n}"`)}if(!n)continue;const l=/url\s*\(/i.test(n),c=/url\s*\(\s*['"]?data:/i.test(n);if(l&&!c||/expression\s*\(/i.test(n)||/javascript:/i.test(n)||/@import/i.test(n)){t.warn(`CSS value for "${r}" contains potentially dangerous pattern: "${n}"`);continue}o.push(`${i}: ${n}`)}return o.join("; ").trim()}function q(e,t,o,r,s){if(e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$check"in e&&typeof e.$check=="string"){const i=e;if(!A(i.$check,"$check",r))return"";const n=y(t,i.$check,o,r,s),c=j(n,i)?i.$then:i.$else;return c===void 0?"":typeof c=="object"&&c!==null&&!Array.isArray(c)?P(c,r):""}return typeof e=="object"&&e!==null&&!Array.isArray(e)?P(e,r):(r.error(`Style attribute must be an object with CSS properties, not ${typeof e}. Example: style: { "color": "red", "font-size": "14px" }`),"")}function B(e,t,o){const r=O.has(e)||[...O].some(n=>n.endsWith("-")&&e.startsWith(n)),s=z[t],i=s&&s.has(e);return!r&&!i?(o.warn(`Attribute "${e}" is not allowed on tag "${t}"`),!1):!0}function F(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$bind"in e}function A(e,t,o){return e==="."?!0:e.includes("..")?(o.error(`${t} does not support parent context access (..) - use interpolation {{..prop}} in content/attributes instead. Invalid: ${t}: "${e}"`),!1):e.includes("{{")?(o.error(`${t} does not support interpolation {{...}} - use literal property paths only. Invalid: ${t}: "${e}"`),!1):!0}function j(e,t){const o=[];for(const n of R)n in t&&o.push({key:n,value:t[n]});if(o.length===0){const n=!!e;return t.$not?!n:n}const r=o.map(n=>{switch(n.key){case"$<":return typeof e=="number"&&typeof n.value=="number"&&e<n.value;case"$>":return typeof e=="number"&&typeof n.value=="number"&&e>n.value;case"$<=":return typeof e=="number"&&typeof n.value=="number"&&e<=n.value;case"$>=":return typeof e=="number"&&typeof n.value=="number"&&e>=n.value;case"$=":return e===n.value;case"$in":return Array.isArray(n.value)&&n.value.includes(e);default:return!1}}),s=t.$join==="OR";let i;return s?i=r.some(n=>n):i=r.every(n=>n),t.$not?!i:i}function K(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$check"in e&&typeof e.$check=="string"}function U(e,t,o=[],r,s){if(!A(e.$check,"$check",r))return"";const i=y(t,e.$check,o,r,s);return j(i,e)?e.$then!==void 0?e.$then:"":e.$else!==void 0?e.$else:""}function V(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$check"in e&&typeof e.$check=="string"}function M(e,t,o=[],r,s){if(!A(t.$check,"$check",r))return!1;const i=y(e,t.$check,o,r,s);return j(i,t)}function Y(e,t){if(!e||typeof e!="object"){t.error("Template object cannot be null, undefined, or non-object");return}const o=Object.entries(e);if(o.length===0){t.error("Template object must have at least one tag");return}const r=o[0];if(!r){t.error("Template object must have at least one tag");return}const[s,i]=r,n=typeof i=="string"?[i]:Array.isArray(i)?i:i?.$children||[],l=i&&typeof i=="object"&&!Array.isArray(i)?Object.fromEntries(Object.entries(i).filter(([c])=>c!=="$children")):{};return{tag:s,rest:i,children:n,attrs:l}}function H(e,t,o=[],r,s){const i=e;if(!i.$check)return r.error('"$if" tag requires $check attribute to specify the condition'),{valueToRender:void 0};if(!A(i.$check,"$check",r))return{valueToRender:void 0};const n=y(t,i.$check,o,r,s);typeof e=="object"&&e!==null&&!Array.isArray(e)&&"$children"in e&&r.warn('"$if" tag does not support $children, use $then and $else instead');const{$then:l,$else:c}=i;if(l!==void 0&&Array.isArray(l))return r.error('"$if" tag $then must be a string or single element object, not an array'),{valueToRender:void 0};if(c!==void 0&&Array.isArray(c))return r.error('"$if" tag $else must be a string or single element object, not an array'),{valueToRender:void 0};const f=(typeof e=="object"&&e!==null&&!Array.isArray(e)?Object.keys(e):[]).filter($=>!E.has($));return f.length>0&&r.warn(`"$if" tag does not support attributes: ${f.join(", ")}. Allowed: ${[...E].join(", ")}`),{valueToRender:j(n,i)?l:c}}const J=(e,t)=>{if(!t)return e.length<=1?e[0]?.[1]??"":e.reduce((r,[,s])=>r+s,"");if(e.length===0)return"";if(e.length===1&&!e[0][1].includes("<"))return e[0][1];let o=`
`;for(let r=0;r<e.length;r++)o+=t.repeat(e[r][0])+e[r][1],r<e.length-1&&(o+=`
`);return o+=`
`,o};function Q(e,t={}){const o=e.data,r=t.logger||console,s=t.propertyFallback,i=t.indent?{indentStr:typeof t.indent=="number"?" ".repeat(t.indent):typeof t.indent=="string"?t.indent:"  ",level:0,logger:r,getOuterProperty:s}:{logger:r,getOuterProperty:s};return p(e.template,o,i)}function X(e,t,o,r,s,i,n,l=[],c){const u=J(r,i),f=u.startsWith(`
`)&&i?i.repeat(n||0):"";if(e==="$comment")return`<!--${u}${f}-->`;const d=`<${e}${Z(t,o,e,l,s,c)}>`;return b.has(e)?d:`${d}${u}${f}</${e}>`}function p(e,t,o){const r=o.parents||[],s=o.logger,i=o.getOuterProperty;if(typeof e=="string")return w(e,t,!0,r,s,i);if(Array.isArray(e))return e.map(a=>p(a,t,o)).join(o.indentStr?`
`:"");const n=Y(e,s);if(!n)return"";const{tag:l,rest:c,children:u,attrs:f}=n;if(!G.has(l))return s.error(`Tag "${l}" is not allowed`),"";if(l==="$comment"&&o.insideComment)return s.error("Nested comments are not allowed"),"";if(l==="$if"){const{valueToRender:a}=H(c,t,r,s,i);return a===void 0?"":p(a,t,o)}b.has(l)&&u.length>0&&s.warn(`Tag "${l}" is a void element and cannot have children`);const d={...o,insideComment:l==="$comment"||o.insideComment,level:(o.level||0)+1},C=a=>a===""?[]:o.indentStr&&a.includes(`
`)&&!a.includes("<")?a.split(`
`).map(T=>[d.level,T]):[[d.level,a]];let $,k;if(F(c)){if(!A(c.$bind,"$bind",s))return"";const a=y(t,c.$bind,[],s,i),{$bind:T,$filter:g,$children:_=[],...D}=c;if(!Array.isArray(a)){if(a!=null&&typeof a!="object")return s.error(`$bind resolved to primitive value of type "${typeof a}", cannot render children`),"";const S=a&&typeof a=="object"&&a!==null?a:{},v=[...r,t];return p({[l]:{...D,$children:_}},S,{...o,parents:v})}let L=a;if(g&&V(g)&&(L=a.filter(S=>{const v=[...r,t];return M(S,g,v,s,i)})),$=[],!b.has(l))for(const S of L){const v=[...r,t];for(const x of _){const ee=p(x,S,{...d,parents:v});$.push(...C(ee))}}k=D}else{if($=[],!b.has(l))for(const a of u){const T=p(a,t,{...d,parents:r});$.push(...C(T))}k=f}return X(l,k,t,$,s,o.indentStr,o.level,r,i)}function Z(e,t,o,r=[],s,i){const n=Object.entries(e).filter(([l])=>B(l,o,s)).map(([l,c])=>{let u;if(l==="style"){if(u=q(c,t,r,s,i),!u)return null}else if(K(c)){const f=U(c,t,r,s,i);u=w(String(f),t,!1,r,s,i)}else u=w(String(c),t,!1,r,s,i);return`${l}="${I(u)}"`}).filter(l=>l!==null).join(" ");return n?" "+n:""}h.renderToString=Q,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=treebark-browser.min.js.map
