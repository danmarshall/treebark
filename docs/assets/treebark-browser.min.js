(function(u,$){typeof exports=="object"&&typeof module<"u"?$(exports):typeof define=="function"&&define.amd?define(["exports"],$):(u=typeof globalThis<"u"?globalThis:u||self,$(u.Treebark={}))})(this,(function(u){"use strict";const $=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a"]),P=new Set(["$comment","$if"]),w=new Set(["img","br","hr"]),R=new Set([...$,...P,...w]),v=new Set(["id","class","style","title","role","data-","aria-"]),W={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])},j=new Set(["$<","$>","$<=","$>=","$=","$in"]),E=new Set(["$check","$then","$else","$not","$join",...j]);function m(e,n,o=[]){if(n===".")return e;let r=e,i=n;for(;i.startsWith("..");){let s=0,t=i;for(;t.startsWith("..");)s++,t=t.substring(2),t.startsWith("/")&&(t=t.substring(1));if(s<=o.length)r=o[o.length-s],i=t.startsWith(".")?t.substring(1):t;else return}return i?i.split(".").reduce((s,t)=>s&&typeof s=="object"&&s!==null?s[t]:void 0,r):r}function g(e){return e.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[n]||n)}function p(e,n,o=!0,r=[]){return e.replace(/\{\{\{([^{]*?)\}\}\}|\{\{([^{]*?)\}\}/g,(i,s,t)=>{if(s!==void 0)return`{{${s.trim()}}}`;const a=t.trim(),l=m(n,a,r);return l==null?"":o?g(String(l)):String(l)})}function G(e,n){const o=v.has(e)||[...v].some(s=>s.endsWith("-")&&e.startsWith(s)),r=W[n],i=r&&r.has(e);if(!o&&!i)throw new Error(`Attribute "${e}" is not allowed on tag "${n}"`)}function L(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$bind"in e}function A(e,n){if(e!=="."){if(e.includes(".."))throw new Error(`${n} does not support parent context access (..) - use interpolation {{..prop}} in content/attributes instead. Invalid: ${n}: "${e}"`);if(e.includes("{{"))throw new Error(`${n} does not support interpolation {{...}} - use literal property paths only. Invalid: ${n}: "${e}"`)}}function O(e,n){const o=[];for(const t of j)t in n&&o.push({key:t,value:n[t]});if(o.length===0){const t=!!e;return n.$not?!t:t}const r=o.map(t=>{switch(t.key){case"$<":return typeof e=="number"&&typeof t.value=="number"&&e<t.value;case"$>":return typeof e=="number"&&typeof t.value=="number"&&e>t.value;case"$<=":return typeof e=="number"&&typeof t.value=="number"&&e<=t.value;case"$>=":return typeof e=="number"&&typeof t.value=="number"&&e>=t.value;case"$=":return e===t.value;case"$in":return Array.isArray(t.value)&&t.value.includes(e);default:return!1}}),i=n.$join==="OR";let s;return i?s=r.some(t=>t):s=r.every(t=>t),n.$not?!s:s}function _(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&"$check"in e&&typeof e.$check=="string"}function k(e,n,o=[]){A(e.$check,"$check");const r=m(n,e.$check,o);return O(r,e)?e.$then!==void 0?e.$then:"":e.$else!==void 0?e.$else:""}function N(e){if(!e||typeof e!="object")throw new Error("Template object cannot be null, undefined, or non-object");const n=Object.entries(e);if(n.length===0)throw new Error("Template object must have at least one tag");const o=n[0];if(!o)throw new Error("Template object must have at least one tag");const[r,i]=o,s=typeof i=="string"?[i]:Array.isArray(i)?i:i?.$children||[],t=i&&typeof i=="object"&&!Array.isArray(i)?Object.fromEntries(Object.entries(i).filter(([a])=>a!=="$children")):{};return{tag:r,rest:i,children:s,attrs:t}}function q(e,n,o=[]){const r=e;if(!r.$check)throw new Error('"$if" tag requires $check attribute to specify the condition');A(r.$check,"$check");const i=m(n,r.$check,o);if(typeof e=="object"&&e!==null&&!Array.isArray(e)&&"$children"in e)throw new Error('"$if" tag does not support $children, use $then and $else instead');const{$then:s,$else:t}=r;if(s!==void 0&&Array.isArray(s))throw new Error('"$if" tag $then must be a string or single element object, not an array');if(t!==void 0&&Array.isArray(t))throw new Error('"$if" tag $else must be a string or single element object, not an array');const l=(typeof e=="object"&&e!==null&&!Array.isArray(e)?Object.keys(e):[]).filter(y=>!E.has(y));if(l.length>0)throw new Error(`"$if" tag does not support attributes: ${l.join(", ")}. Allowed: ${[...E].join(", ")}`);return{valueToRender:O(i,r)?s:t}}const D=(e,n)=>{if(!n)return e.length<=1?e[0]?.[1]??"":e.reduce((r,[,i])=>r+i,"");if(e.length===0)return"";if(e.length===1&&!e[0][1].includes("<"))return e[0][1];let o=`
`;for(let r=0;r<e.length;r++)o+=n.repeat(e[r][0])+e[r][1],r<e.length-1&&(o+=`
`);return o+=`
`,o};function B(e,n={}){const o=Array.isArray(e.data)?e.data:{...e.data,...n.data},r=n.indent?{indentStr:typeof n.indent=="number"?" ".repeat(n.indent):typeof n.indent=="string"?n.indent:"  ",level:0}:{};return d(e.template,o,r)}function K(e,n,o,r,i,s,t=[]){const a=D(r,i),l=a.startsWith(`
`)&&i?i.repeat(s||0):"";if(e==="$comment")return`<!--${a}${l}-->`;const f=`<${e}${F(n,o,e,t)}>`;return w.has(e)?f:`${f}${a}${l}</${e}>`}function d(e,n,o={}){const r=o.parents||[];if(typeof e=="string")return p(e,n,!0,r);if(Array.isArray(e))return e.map(c=>d(c,n,o)).join(o.indentStr?`
`:"");const{tag:i,rest:s,children:t,attrs:a}=N(e);if(!R.has(i))throw new Error(`Tag "${i}" is not allowed`);if(i==="$comment"&&o.insideComment)throw new Error("Nested comments are not allowed");if(i==="$if"){const{valueToRender:c}=q(s,n,r);return c===void 0?"":d(c,n,o)}if(w.has(i)&&t.length>0)throw new Error(`Tag "${i}" is a void element and cannot have children`);const l={...o,insideComment:i==="$comment"||o.insideComment,level:(o.level||0)+1},f=c=>c===""?[]:o.indentStr&&c.includes(`
`)&&!c.includes("<")?c.split(`
`).map(b=>[l.level,b]):[[l.level,c]];let h,y;if(L(s)){A(s.$bind,"$bind");const c=m(n,s.$bind,[]),{$bind:b,$children:C=[],...I}=s;if(!Array.isArray(c)){const S=c&&typeof c=="object"&&c!==null?c:{},T=[...r,n];return d({[i]:{...I,$children:C}},S,{...o,parents:T})}h=[];for(const S of c){const T=[...r,n];for(const M of C){const Y=d(M,S,{...l,parents:T});h.push(...f(Y))}}y=I}else{h=[];for(const c of t){const b=d(c,n,{...l,parents:r});h.push(...f(b))}y=a}return K(i,y,n,h,o.indentStr,o.level,r)}function F(e,n,o,r=[]){const i=Object.entries(e).filter(([s])=>(G(s,o),!0)).map(([s,t])=>{if(_(t)){const a=k(t,n,r);return`${s}="${g(p(String(a),n,!1,r))}"`}else return`${s}="${g(p(String(t),n,!1,r))}"`}).join(" ");return i?" "+i:""}u.renderToString=B,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=treebark-browser.min.js.map
