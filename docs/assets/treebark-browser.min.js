!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Treebark={})}(this,function(t){"use strict";const e=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a","comment"]),n=new Set(["img"]),r=new Set([...e,...n]),o=new Set(["id","class","style","title","role","data-","aria-"]),i={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])};function a(t,e,n=[]){if("."===e)return t;let r=t,o=e;for(;o.startsWith("..");){let t=0,e=o;for(;e.startsWith("..");)t++,e=e.substring(2),e.startsWith("/")&&(e=e.substring(1));if(!(t<=n.length))return;r=n[n.length-t],o=e.startsWith(".")?e.substring(1):e}return o?o.split(".").reduce((t,e)=>t&&"object"==typeof t&&null!==t?t[e]:void 0,r):r}function s(t){return t.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]||t))}function l(t,e,n=!0,r=[]){return t.replace(/(\{\{\{|\{\{)(.*?)(\}\}\}|\}\})/g,(t,o,i,l)=>{const c=i.trim();if("{{{"===o)return`{{${c}}}`;const d=a(e,c,r);return null==d?"":n?s(String(d)):String(d)})}const c=(t,e,n=!1,r=0)=>{const o=t&&e&&(n?e.startsWith("<"):e.includes("<"));return[Boolean(o),o?t.repeat(r):""]};function d(t,e,r,a,d,u,f=[]){const[p,h]=c(d,a,!1,u||0),m=p?`\n${a}\n${h}`:a||"";if("comment"===t)return`\x3c!--${m}--\x3e`;const b=`<${t}${function(t,e,n,r=[]){const a=Object.entries(t).filter(([t])=>(function(t,e){const n=o.has(t)||[...o].some(e=>e.endsWith("-")&&t.startsWith(e)),r=i[e],a=r&&r.has(t);if(!n&&!a)throw new Error(`Attribute "${t}" is not allowed on tag "${e}"`)}(t,n),!0)).map(([t,n])=>`${t}="${s(l(String(n),e,!1,r))}"`).join(" ");return a?" "+a:""}(e,r,t,f)}>`;return n.has(t)?b:`${b}${m}</${t}>`}function u(t,e,o={}){const i=o.parents||[];if("string"==typeof t)return l(t,e,!0,i);if(Array.isArray(t))return t.map(t=>u(t,e,o)).join(o.indentStr?"\n":"");const{tag:s,rest:f,children:p,attrs:h}=function(t){if(!t||"object"!=typeof t)throw new Error("Template object cannot be null, undefined, or non-object");const e=Object.entries(t);if(0===e.length)throw new Error("Template object must have at least one tag");const n=e[0];if(!n)throw new Error("Template object must have at least one tag");const[r,o]=n;return{tag:r,rest:o,children:"string"==typeof o?[o]:Array.isArray(o)?o:(null==o?void 0:o.$children)||[],attrs:o&&"object"==typeof o&&!Array.isArray(o)?Object.fromEntries(Object.entries(o).filter(([t])=>"$children"!==t)):{}}}(t);if(!r.has(s))throw new Error(`Tag "${s}" is not allowed`);if("comment"===s&&o.insideComment)throw new Error("Nested comments are not allowed");if(n.has(s)&&p.length>0)throw new Error(`Tag "${s}" is a void element and cannot have children`);const m={...o,insideComment:"comment"===s||o.insideComment,level:(o.level||0)+1},b=(t,e,n,r)=>t.map(t=>{const n=u(t,e,{...m,parents:r}),[i,a]=c(o.indentStr,n,!0,m.level);return i?a+n:n}).join(n);let y,g;if(function(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&"$bind"in t}(f)){!function(t){if("."!==t){if(t.includes(".."))throw new Error(`$bind does not support parent context access (..) - use interpolation {{..prop}} in content/attributes instead. Invalid: $bind: "${t}"`);if(t.includes("{{"))throw new Error(`$bind does not support interpolation {{...}} - use literal property paths only. Invalid: $bind: "${t}"`)}}(f.$bind);const t=a(e,f.$bind,[]),{$bind:n,$children:r=[],...l}=f;if(!Array.isArray(t)){const n=t&&"object"==typeof t&&null!==t?t:{},a=[...i,e];return u({[s]:{...l,$children:r}},n,{...o,parents:a})}y=t.map(t=>{const n=[...i,e];return b(r,t,"",n)}).join(o.indentStr?"\n":""),g=l}else y=b(p,e,o.indentStr?"\n":"",i),g=h;return d(s,g,e,y,o.indentStr,o.level,i)}t.renderToString=function(t,e={}){const n=Array.isArray(t.data)?t.data:{...t.data,...e.data},r=e.indent?{indentStr:"number"==typeof e.indent?" ".repeat(e.indent):"string"==typeof e.indent?e.indent:"  ",level:0}:{};if(!Array.isArray(t.template)&&Array.isArray(t.data)&&!function(t){if(Array.isArray(t)||"object"!=typeof t||null===t)return!1;const e=Object.entries(t);if(0===e.length)return!1;const[,n]=e[0];return!(!n||"object"!=typeof n||Array.isArray(n))&&"$bind"in n&&"."===n.$bind}(t.template)){const n=r.indentStr?"\n":"";return t.data.map(n=>u(t.template,{...n,...e.data},r)).join(n)}return u(t.template,n,r)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=treebark-browser.min.js.map
