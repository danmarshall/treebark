(function(h,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(h=typeof globalThis<"u"?globalThis:h||self,b(h.Treebark={}))})(this,(function(h){"use strict";const b=new Set(["div","span","p","header","footer","main","section","article","h1","h2","h3","h4","h5","h6","strong","em","blockquote","code","pre","ul","ol","li","table","thead","tbody","tr","th","td","a"]),I=new Set(["$comment","$if"]),m=new Set(["img","br","hr"]),L=new Set([...b,...I,...m]),k=new Set(["id","class","style","title","role","data-","aria-"]),W={a:new Set(["href","target","rel"]),img:new Set(["src","alt","width","height"]),table:new Set(["summary"]),th:new Set(["scope","colspan","rowspan"]),td:new Set(["scope","colspan","rowspan"]),blockquote:new Set(["cite"])},C=new Set(["$<","$>","$<=","$>=","$=","$in"]),O=new Set(["$check","$then","$else","$not","$join",...C]),_=new Set(["display","position","top","right","bottom","left","z-index","float","clear","overflow","overflow-x","overflow-y","visibility","width","height","min-width","min-height","max-width","max-height","margin","margin-top","margin-right","margin-bottom","margin-left","padding","padding-top","padding-right","padding-bottom","padding-left","box-sizing","border","border-width","border-style","border-color","border-radius","border-top","border-right","border-bottom","border-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","outline","outline-width","outline-style","outline-color","outline-offset","background","background-color","background-position","background-size","background-repeat","background-attachment","background-clip","background-origin","color","font","font-family","font-size","font-weight","font-style","font-variant","line-height","letter-spacing","word-spacing","text-align","text-decoration","text-indent","text-transform","text-shadow","text-overflow","white-space","word-wrap","word-break","vertical-align","direction","unicode-bidi","list-style","list-style-type","list-style-position","border-collapse","border-spacing","caption-side","empty-cells","table-layout","flex","flex-direction","flex-wrap","flex-flow","justify-content","align-items","align-content","align-self","flex-grow","flex-shrink","flex-basis","order","gap","row-gap","column-gap","grid","grid-template","grid-template-columns","grid-template-rows","grid-template-areas","grid-column","grid-row","grid-area","grid-auto-columns","grid-auto-rows","grid-auto-flow","grid-column-start","grid-column-end","grid-row-start","grid-row-end","transform","transform-origin","transition","transition-property","transition-duration","transition-timing-function","transition-delay","animation","animation-name","animation-duration","animation-timing-function","animation-delay","animation-iteration-count","animation-direction","animation-fill-mode","animation-play-state","opacity","box-shadow","filter","backdrop-filter","cursor","pointer-events","resize","user-select","content","quotes","counter-reset","counter-increment","object-fit","object-position"]);function y(t,n,o=[],i){if(n===".")return t;let r=t,s=n;for(;s.startsWith("..");){let e=0,a=s;for(;a.startsWith("..");)e++,a=a.substring(2),a.startsWith("/")&&(a=a.substring(1));if(e<=o.length)r=o[o.length-e],s=a.startsWith(".")?a.substring(1):a;else return}if(s){if(i&&typeof r!="object"&&r!==null&&r!==void 0){i.error(`Cannot access property "${s}" on primitive value of type "${typeof r}"`);return}return s.split(".").reduce((e,a)=>e&&typeof e=="object"&&e!==null?e[a]:void 0,r)}return r}function R(t){return t.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[n]||n)}function w(t,n,o=!0,i=[],r){return t.replace(/\{\{\{([^{]*?)\}\}\}|\{\{([^{]*?)\}\}/g,(s,e,a)=>{if(e!==void 0)return`{{${e.trim()}}}`;const c=a.trim(),d=y(n,c,i,r);return d==null?"":o?R(String(d)):String(d)})}function D(t,n){const o=[];for(const[i,r]of Object.entries(t)){const s=i;if(!_.has(s)){n.warn(`CSS property "${i}" is not in the allowed list`);continue}if(r==null)continue;const e=String(r).trim(),a=/url\s*\(/i.test(e),c=/url\s*\(\s*['"]?data:/i.test(e);if(a&&!c||/expression\s*\(/i.test(e)||/javascript:/i.test(e)||/@import/i.test(e)){n.warn(`CSS value for "${i}" contains potentially dangerous pattern: "${e}"`);continue}o.push(`${s}: ${e}`)}return o.join("; ")}function G(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"$check"in t&&typeof t.$check=="string"&&("$then"in t||"$else"in t)}function x(t,n,o,i){if(G(t)){const r=t;if(!$(r.$check,"$check",i))return"";const s=y(n,r.$check,o),a=A(s,r)?r.$then:r.$else;return a===void 0?"":x(a,n,o,i)}return typeof t=="object"&&t!==null&&!Array.isArray(t)?D(t,i):(i.error(`Style attribute must be an object with CSS properties, not ${typeof t}. Example: style: { "color": "red", "font-size": "14px" }`),"")}function z(t,n,o){const i=k.has(t)||[...k].some(e=>e.endsWith("-")&&t.startsWith(e)),r=W[n],s=r&&r.has(t);return!i&&!s?(o.warn(`Attribute "${t}" is not allowed on tag "${n}"`),!1):!0}function q(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"$bind"in t}function $(t,n,o){return t==="."?!0:t.includes("..")?(o.error(`${n} does not support parent context access (..) - use interpolation {{..prop}} in content/attributes instead. Invalid: ${n}: "${t}"`),!1):t.includes("{{")?(o.error(`${n} does not support interpolation {{...}} - use literal property paths only. Invalid: ${n}: "${t}"`),!1):!0}function A(t,n){const o=[];for(const e of C)e in n&&o.push({key:e,value:n[e]});if(o.length===0){const e=!!t;return n.$not?!e:e}const i=o.map(e=>{switch(e.key){case"$<":return typeof t=="number"&&typeof e.value=="number"&&t<e.value;case"$>":return typeof t=="number"&&typeof e.value=="number"&&t>e.value;case"$<=":return typeof t=="number"&&typeof e.value=="number"&&t<=e.value;case"$>=":return typeof t=="number"&&typeof e.value=="number"&&t>=e.value;case"$=":return t===e.value;case"$in":return Array.isArray(e.value)&&e.value.includes(t);default:return!1}}),r=n.$join==="OR";let s;return r?s=i.some(e=>e):s=i.every(e=>e),n.$not?!s:s}function N(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"$check"in t&&typeof t.$check=="string"}function B(t,n,o=[],i){if(!$(t.$check,"$check",i))return"";const r=y(n,t.$check,o);return A(r,t)?t.$then!==void 0?t.$then:"":t.$else!==void 0?t.$else:""}function K(t,n){if(!t||typeof t!="object"){n.error("Template object cannot be null, undefined, or non-object");return}const o=Object.entries(t);if(o.length===0){n.error("Template object must have at least one tag");return}const i=o[0];if(!i){n.error("Template object must have at least one tag");return}const[r,s]=i,e=typeof s=="string"?[s]:Array.isArray(s)?s:s?.$children||[],a=s&&typeof s=="object"&&!Array.isArray(s)?Object.fromEntries(Object.entries(s).filter(([c])=>c!=="$children")):{};return{tag:r,rest:s,children:e,attrs:a}}function U(t,n,o=[],i){const r=t;if(!r.$check)return i.error('"$if" tag requires $check attribute to specify the condition'),{valueToRender:void 0};if(!$(r.$check,"$check",i))return{valueToRender:void 0};const s=y(n,r.$check,o);typeof t=="object"&&t!==null&&!Array.isArray(t)&&"$children"in t&&i.warn('"$if" tag does not support $children, use $then and $else instead');const{$then:e,$else:a}=r;if(e!==void 0&&Array.isArray(e))return i.error('"$if" tag $then must be a string or single element object, not an array'),{valueToRender:void 0};if(a!==void 0&&Array.isArray(a))return i.error('"$if" tag $else must be a string or single element object, not an array'),{valueToRender:void 0};const d=(typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.keys(t):[]).filter(f=>!O.has(f));return d.length>0&&i.warn(`"$if" tag does not support attributes: ${d.join(", ")}. Allowed: ${[...O].join(", ")}`),{valueToRender:A(s,r)?e:a}}const F=(t,n)=>{if(!n)return t.length<=1?t[0]?.[1]??"":t.reduce((i,[,r])=>i+r,"");if(t.length===0)return"";if(t.length===1&&!t[0][1].includes("<"))return t[0][1];let o=`
`;for(let i=0;i<t.length;i++)o+=n.repeat(t[i][0])+t[i][1],i<t.length-1&&(o+=`
`);return o+=`
`,o};function M(t,n={}){const o=t.data,i=n.logger||console,r=n.indent?{indentStr:typeof n.indent=="number"?" ".repeat(n.indent):typeof n.indent=="string"?n.indent:"  ",level:0,logger:i}:{logger:i};return p(t.template,o,r)}function V(t,n,o,i,r,s,e,a=[]){const c=F(i,s),d=c.startsWith(`
`)&&s?s.repeat(e||0):"";if(t==="$comment")return`<!--${c}${d}-->`;const u=`<${t}${Y(n,o,t,a,r)}>`;return m.has(t)?u:`${u}${c}${d}</${t}>`}function p(t,n,o){const i=o.parents||[],r=o.logger;if(typeof t=="string")return w(t,n,!0,i,r);if(Array.isArray(t))return t.map(l=>p(l,n,o)).join(o.indentStr?`
`:"");const s=K(t,r);if(!s)return"";const{tag:e,rest:a,children:c,attrs:d}=s;if(!L.has(e))return r.error(`Tag "${e}" is not allowed`),"";if(e==="$comment"&&o.insideComment)return r.error("Nested comments are not allowed"),"";if(e==="$if"){const{valueToRender:l}=U(a,n,i,r);return l===void 0?"":p(l,n,o)}m.has(e)&&c.length>0&&r.warn(`Tag "${e}" is a void element and cannot have children`);const u={...o,insideComment:e==="$comment"||o.insideComment,level:(o.level||0)+1},S=l=>l===""?[]:o.indentStr&&l.includes(`
`)&&!l.includes("<")?l.split(`
`).map(g=>[u.level,g]):[[u.level,l]];let f,v;if(q(a)){if(!$(a.$bind,"$bind",r))return"";const l=y(n,a.$bind,[],r),{$bind:g,$children:P=[],...E}=a;if(!Array.isArray(l)){if(l!=null&&typeof l!="object")return r.error(`$bind resolved to primitive value of type "${typeof l}", cannot render children`),"";const j=l&&typeof l=="object"&&l!==null?l:{},T=[...i,n];return p({[e]:{...E,$children:P}},j,{...o,parents:T})}if(f=[],!m.has(e))for(const j of l){const T=[...i,n];for(const H of P){const J=p(H,j,{...u,parents:T});f.push(...S(J))}}v=E}else{if(f=[],!m.has(e))for(const l of c){const g=p(l,n,{...u,parents:i});f.push(...S(g))}v=d}return V(e,v,n,f,r,o.indentStr,o.level,i)}function Y(t,n,o,i=[],r){const s=Object.entries(t).filter(([e])=>z(e,o,r)).map(([e,a])=>{let c;if(e==="style"){if(c=x(a,n,i,r),!c)return null}else if(N(a)){const d=B(a,n,i,r);c=w(String(d),n,!1,i,r)}else c=w(String(a),n,!1,i,r);return`${e}="${R(c)}"`}).filter(e=>e!==null).join(" ");return s?" "+s:""}h.renderToString=M,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=treebark-browser.min.js.map
