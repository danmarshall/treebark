<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treebark Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .demo-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .demo-title {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 0.5rem;
        }
        .schema {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        .result {
            border: 1px solid #007acc;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .html-output {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .output-section {
            margin: 0.5rem 0;
        }
        .output-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        .card {
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 8px;
            background: #fafafa;
        }
        .user-card {
            border: 1px solid #007acc;
            padding: 1rem;
            border-radius: 8px;
            background: #f0f8ff;
        }
        .product-card {
            border: 1px solid #28a745;
            padding: 1rem;
            border-radius: 8px;
            background: #f8fff8;
        }
        .error {
            color: #dc3545;
            background: #ffe6e6;
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <h1>ðŸŒ³ Treebark Demo</h1>
    <p>Safe HTML tree structures for Markdown and content-driven apps.</p>

    <div class="demo-section">
        <h2 class="demo-title">Hello World</h2>
        <div class="schema">{ "div": "Hello world" }</div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="hello-world"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="hello-world-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Element with Attributes</h2>
        <div class="schema">
{
  "div": {
    "class": "card",
    "$children": ["Hello from a card!"]
  }
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="card-example"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="card-example-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Shorthand Array Syntax</h2>
        <div class="schema">
{
  "div": [
    { "h2": "Welcome" },
    { "p": "This is much cleaner!" },
    { "ul": [
        { "li": "Item 1" },
        { "li": "Item 2" },
        { "li": "Item 3" }
      ]
    }
  ]
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="shorthand-example"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="shorthand-example-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Data Binding</h2>
        <div class="schema">
{
  "div": {
    "class": "user-card",
    "$children": [
      { "h2": "{{name}}" },
      { "p": "{{email}}" }
    ]
  }
}
Data: { "name": "Alice Johnson", "email": "alice@example.com" }
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="data-binding"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="data-binding-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Array Binding</h2>
        <div class="schema">
{
  "ul": {
    "$bind": "products",
    "$children": [
      { "li": "{{name}} â€” {{price}}" }
    ]
  }
}
Data: {
  "products": [
    { "name": "Laptop", "price": "$999" },
    { "name": "Phone", "price": "$499" },
    { "name": "Tablet", "price": "$299" }
  ]
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="array-binding"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="array-binding-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Nested Data: Customer Orders</h2>
        <div class="schema">
{
  "div": {
    "class": "user-card",
    "$children": [
      { "h2": "Customer: {{name}}" },
      { "p": "Email: {{email}}" },
      { "h3": "Orders:" },
      { "div": {
          "$bind": "orders",
          "$children": [
            { "div": {
                "class": "card",
                "style": "margin: 1rem 0; padding: 1rem;",
                "$children": [
                  { "h4": "Order #{{orderNumber}} - {{date}}" },
                  { "p": "Total: {{total}}" },
                  { "h5": "Products:" },
                  { "ul": {
                      "$bind": "products",
                      "$children": [
                        { "li": {
                            "class": "product-item",
                            "$children": [
                              { "strong": "{{name}}" },
                              " Ã— {{quantity}} - ",
                              { "span": { 
                                  "style": "color: #28a745; font-weight: bold;",
                                  "$children": ["{{price}}"]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
Data: {
  "name": "Sarah Wilson",
  "email": "sarah@example.com",
  "orders": [
    {
      "orderNumber": "1001",
      "date": "2024-01-15",
      "total": "$1,297",
      "products": [
        { "name": "Laptop", "quantity": "1", "price": "$999" },
        { "name": "Mouse", "quantity": "2", "price": "$149" },
        { "name": "USB Cable", "quantity": "3", "price": "$149" }
      ]
    },
    {
      "orderNumber": "1002", 
      "date": "2024-02-03",
      "total": "$599",
      "products": [
        { "name": "Monitor", "quantity": "1", "price": "$299" },
        { "name": "Keyboard", "quantity": "1", "price": "$129" },
        { "name": "Webcam", "quantity": "1", "price": "$171" }
      ]
    }
  ]
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="nested-data-example"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="nested-data-example-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Shorthand Array with Data Binding</h2>
        <div class="schema">
{
  "div": [
    { "h2": "Profile: {{name}}" },
    { "p": "Contact: {{email}}" },
    { "div": [
        "Skills: ",
        { "strong": "{{skills}}" }
      ]
    }
  ]
}
Data: { 
  "name": "Bob Smith", 
  "email": "bob@example.com",
  "skills": "JavaScript, TypeScript, React"
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="shorthand-data-example"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="shorthand-data-example-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Self-Contained Template</h2>
        <div class="schema">
{
  "$template": {
    "div": {
      "class": "product-card",
      "$children": [
        { "h2": "{{name}}" },
        { "p": "Only {{price}}!" }
      ]
    }
  },
  "$data": {
    "name": "Gaming Laptop",
    "price": "$1299"
  }
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="self-contained"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="self-contained-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Mixed Content</h2>
        <div class="schema">
{
  "div": {
    "$children": [
      "Hello ",
      { "span": { "style": "color: blue;", "$children": ["World"] } },
      "!"
    ]
  }
}
        </div>
        <div class="output-section">
            <div class="output-label">Rendered Output:</div>
            <div class="result" id="mixed-content"></div>
        </div>
        <div class="output-section">
            <div class="output-label">Generated HTML:</div>
            <div class="html-output" id="mixed-content-html"></div>
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">Security Demo</h2>
        <div class="schema">Trying to use disallowed tag: { "script": "alert('XSS')" }</div>
        <div class="output-section">
            <div class="output-label">Result:</div>
            <div class="result" id="security-demo"></div>
        </div>
    </div>

    <script type="module">
        // Import the actual treebark library (browser bundle)
        import { renderToDOM } from '../../treebark/dist/treebark-browser.js';

        // Helper function to get HTML from DOM elements
        function getHTMLFromFragment(fragment) {
            const tempDiv = document.createElement('div');
            tempDiv.appendChild(fragment.cloneNode(true));
            return tempDiv.innerHTML;
        }

        // Helper function to render and display both DOM and HTML for an example
        function renderExample(containerId, htmlId, schema, options = {}) {
            try {
                const fragment = renderToDOM(schema, options);
                document.getElementById(containerId).appendChild(fragment.cloneNode(true));
                
                if (htmlId) {
                    const html = getHTMLFromFragment(fragment);
                    document.getElementById(htmlId).textContent = html;
                }
            } catch (error) {
                console.error(`Error in ${containerId}:`, error);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.textContent = `Error: ${error.message}`;
                document.getElementById(containerId).appendChild(errorDiv);
            }
        }

        // Demo examples
        try {
            // Hello World
            renderExample('hello-world', 'hello-world-html', 
                { div: "Hello world" }
            );

            // Card Example
            renderExample('card-example', 'card-example-html',
                {
                    div: {
                        class: "card",
                        $children: ["Hello from a card!"]
                    }
                }
            );

            // Shorthand Array Syntax
            renderExample('shorthand-example', 'shorthand-example-html',
                {
                    div: [
                        { h2: "Welcome" },
                        { p: "This is much cleaner!" },
                        { ul: [
                            { li: "Item 1" },
                            { li: "Item 2" },
                            { li: "Item 3" }
                        ]}
                    ]
                }
            );

            // Data Binding
            renderExample('data-binding', 'data-binding-html',
                {
                    div: {
                        class: "user-card",
                        $children: [
                            { h2: "{{name}}" },
                            { p: "{{email}}" }
                        ]
                    }
                },
                { data: { name: "Alice Johnson", email: "alice@example.com" } }
            );

            // Array Binding
            renderExample('array-binding', 'array-binding-html',
                {
                    ul: {
                        $bind: "products",
                        $children: [
                            { li: "{{name}} â€” {{price}}" }
                        ]
                    }
                },
                {
                    data: {
                        products: [
                            { name: "Laptop", price: "$999" },
                            { name: "Phone", price: "$499" },
                            { name: "Tablet", price: "$299" }
                        ]
                    }
                }
            );

            // Nested Data: Customer Orders
            renderExample('nested-data-example', 'nested-data-example-html',
                {
                    div: {
                        class: "user-card",
                        $children: [
                            { h2: "Customer: {{name}}" },
                            { p: "Email: {{email}}" },
                            { h3: "Orders:" },
                            { div: {
                                $bind: "orders",
                                $children: [
                                    { div: {
                                        class: "card",
                                        style: "margin: 1rem 0; padding: 1rem;",
                                        $children: [
                                            { h4: "Order #{{orderNumber}} - {{date}}" },
                                            { p: "Total: {{total}}" },
                                            { h5: "Products:" },
                                            { ul: {
                                                $bind: "products",
                                                $children: [
                                                    { li: {
                                                        class: "product-item",
                                                        $children: [
                                                            { strong: "{{name}}" },
                                                            " Ã— {{quantity}} - ",
                                                            { span: { 
                                                                style: "color: #28a745; font-weight: bold;",
                                                                $children: ["{{price}}"]
                                                            }}
                                                        ]
                                                    }}
                                                ]
                                            }}
                                        ]
                                    }}
                                ]
                            }}
                        ]
                    }
                },
                {
                    data: {
                        name: "Sarah Wilson",
                        email: "sarah@example.com",
                        orders: [
                            {
                                orderNumber: "1001",
                                date: "2024-01-15",
                                total: "$1,297",
                                products: [
                                    { name: "Laptop", quantity: "1", price: "$999" },
                                    { name: "Mouse", quantity: "2", price: "$149" },
                                    { name: "USB Cable", quantity: "3", price: "$149" }
                                ]
                            },
                            {
                                orderNumber: "1002",
                                date: "2024-02-03", 
                                total: "$599",
                                products: [
                                    { name: "Monitor", quantity: "1", price: "$299" },
                                    { name: "Keyboard", quantity: "1", price: "$129" },
                                    { name: "Webcam", quantity: "1", price: "$171" }
                                ]
                            }
                        ]
                    }
                }
            );

            // Shorthand Array with Data Binding
            renderExample('shorthand-data-example', 'shorthand-data-example-html',
                {
                    div: [
                        { h2: "Profile: {{name}}" },
                        { p: "Contact: {{email}}" },
                        { div: [
                            "Skills: ",
                            { strong: "{{skills}}" }
                        ]}
                    ]
                },
                { 
                    data: { 
                        name: "Bob Smith", 
                        email: "bob@example.com",
                        skills: "JavaScript, TypeScript, React"
                    }
                }
            );

            // Self-contained
            renderExample('self-contained', 'self-contained-html',
                {
                    $template: {
                        div: {
                            class: "product-card",
                            $children: [
                                { h2: "{{name}}" },
                                { p: "Only {{price}}!" }
                            ]
                        }
                    },
                    $data: {
                        name: "Gaming Laptop",
                        price: "$1299"
                    }
                }
            );

            // Mixed Content
            renderExample('mixed-content', 'mixed-content-html',
                {
                    div: {
                        $children: [
                            "Hello ",
                            { span: { style: "color: blue;", $children: ["World"] } },
                            "!"
                        ]
                    }
                }
            );

        } catch (error) {
            console.error('Demo error:', error);
        }

        // Security Demo
        try {
            document.getElementById('security-demo').appendChild(
                renderToDOM({ script: "alert('XSS')" })
            );
        } catch (error) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = `Security check passed: ${error.message}`;
            document.getElementById('security-demo').appendChild(errorDiv);
        }
    </script>
</body>
</html>