# ðŸŒ³ Treebark  

> Safe HTML tree structures for Markdown and content-driven apps.

---

## ðŸš§ Problem  
You want to use HTML structures embedded in user-generated content, such as a blog post in Markdown.

Markdown was originally designed as a **superset of HTML** â€” you could drop raw `<div>`s, `<table>`s, or even `<script>`s straight into your content.  

But for **safety and consistency**, many Markdown parsers (especially in CMSs, wikis, and chat apps) **disallow raw HTML**. That means:  

- Authors canâ€™t use existing site CSS components (headers, footers, grids).  
- Structured layouts like tables or cards are awkward or impossible.  
- Allowing raw HTML invites XSS and security issues.  

---

## ðŸŒ³ Solution  

**Treebark** brings back safe structured markup by replacing raw HTML with **tree schemas** (JSON or YAML).  

- Safe by default: only whitelisted tags/attrs are allowed.  
- Fits naturally into Markdown fenced code blocks.  
- Flexible enough for both **static content** and **data-bound apps**.  

#### ðŸ’¡ Key Insight  

Templates donâ€™t need a parser or compiler.  

By using **object keys as tag names**, the schema is both natural and trivial to implement:  

```json
{ "div": "Hello world" }
```  

Thatâ€™s it â€” a `div` with text, expressed as pure data. No angle brackets, no parser, just a structural walk of the object tree.  

---

## âœ¨ Examples  

### Hello World  

```json
{ "div": "Hello world" }
```  

**Output:**
```
<div>Hello world</div>
```  

---

### With Data Binding

**Template:**
```json
{
  "template": {
    "div": {
      "class": "card",
      "$children": [
        { "h2": "{{title}}" },
        { "p": "{{description}}" }
      ]
    }
  },
  "data": { "title": "Treebark Demo", "description": "CMS-driven and data-bound!" }
}
```  

**Output:**  
```html
<div class="card">
  <h2>Treebark Demo</h2>
  <p>CMS-driven and data-bound!</p>
</div>
```  

---

### Automatic Array Iteration

When you provide a single template with array data, Treebark automatically creates multiple instances:

**Template:**
```json
{
  "template": {
    "div": {
      "class": "product-card",
      "$children": [
        { "h2": "{{name}}" },
        { "p": "Only {{price}}!" }
      ]
    }
  },
  "data": [
    { "name": "Laptop", "price": "$999" },
    { "name": "Mouse", "price": "$25" }
  ]
}
```

**Output:**
```html
<div class="product-card">
  <h2>Laptop</h2>
  <p>Only $999!</p>
</div>
<div class="product-card">
  <h2>Mouse</h2>
  <p>Only $25!</p>
</div>
```

This eliminates the need for verbose `$bind` syntax in simple cases while preserving all existing `$bind` functionality.

---

### Shorthand Array Syntax  

For nodes without attributes, you can use a shorthand array syntax instead of `$children`:

```json
{
  "div": [
    { "h2": "Welcome" },
    { "p": "This is much cleaner!" },
    {
      "ul": [
        { "li": "Item 1" },
        { "li": "Item 2" }
      ]
    }
  ]
}
```  

**Output:**
```
<div><h2>Welcome</h2><p>This is much cleaner!</p><ul><li>Item 1</li><li>Item 2</li></ul></div>
```

This is equivalent to:

```json
{
  "div": {
    "$children": [
      { "h2": "Welcome" }, 
      { "p": "This is much cleaner!" },
      {
        "ul": {
          "$children": [
            { "li": "Item 1" },
            { "li": "Item 2" }
          ]
        }
      }
    ]
  }
}
```

**Note:** Shorthand syntax only works when the node has no attributes. If you need attributes, use the explicit `$children` syntax.

---

### Advanced Array Binding with $bind

For more complex array scenarios, you can still use the `$bind` syntax:

**Template:**
```json
{
  "template": {
    "ul": {
      "$bind": "products",
      "$children": [
        { "li": "{{name}} â€” {{price}}" }
      ]
    }
  },
  "data": {
    "products": [
      { "name": "Laptop", "price": "$999" },
      { "name": "Phone", "price": "$499" }
    ]
  }
}
```  

**Output:**  
```html
<ul>
  <li>Laptop â€” $999</li>
  <li>Phone â€” $499</li>
</ul>
```  

---

### Mixed Content  

```json
{
  "div": {
    "$children": [
      "Hello ",
      { "span": "World" },
      "!"
    ]
  }
}
```  

**Output:**
```
<div>Hello <span>World</span>!</div>
```  

---

### Comments

HTML comments can be created using the `comment` tag:

```json treebark
{ "comment": "This is a comment" }
```

â†’ `<!--This is a comment-->`

Comments support interpolation and mixed content like other tags:

```json treebark
{
  "comment": {
    "$children": [
      "Generated by {{generator}} on ",
      { "span": "{{date}}" }
    ]
  }
}
```

**Data:**
```json
{ "generator": "Treebark", "date": "2024-01-01" }
```

â†’ `<!--Generated by Treebark on <span>2024-01-01</span>-->`

**Note:** Comments cannot be nested - attempting to place a `comment` tag inside another `comment` will result in an error.

---

### YAML Format (Much Cleaner!)

When using the js-yaml library, you can write much cleaner YAML syntax. Here's the "Bound to an Array" example in both formats for comparison:

**JSON Format:**
```json
{
  "ul": {
    "$bind": "products",
    "$children": [
      { "li": "{{name}} â€” {{price}}" }
    ]
  }
}
```

**YAML Format (Much Cleaner!):**
```yaml
ul:
  $bind: products
  $children:
    - li: "{{name}} â€” {{price}}"
```

---

## ðŸ“¦ Available Libraries

### Implementations

- **[Node.js/Browser](nodejs/packages/treebark/)** - Core library with [`renderToString`](nodejs/packages/treebark/#rendertostringinput-options) and [`renderToDOM`](nodejs/packages/treebark/#rendertodominput-options) renderers
  - **[markdown-it plugin](nodejs/packages/markdown-it-treebark/)** - Render treebark templates in Markdown
- **Other Languages** - Not yet available. If you need treebark support for your language, please [file a feature request](https://github.com/danmarshall/treebark/issues/new)

---

## ðŸ“¦ Safe by Default  

Treebark ships with a strict whitelist:  

- **Allowed tags:**  
  `div`, `span`, `p`, `header`, `footer`, `main`, `section`, `article`,  
  `h1`â€“`h6`, `strong`, `em`, `blockquote`, `code`, `pre`,  
  `ul`, `ol`, `li`,  
  `table`, `thead`, `tbody`, `tr`, `th`, `td`,  
  `a`, `img`, `comment`  

- **Allowed attributes:**  
  - Global: `id`, `class`, `style`, `title`, `aria-*`, `data-*`, `role`  
  - `a`: `href`, `target`, `rel`  
  - `img`: `src`, `alt`, `width`, `height`  
  - `table`: `summary`  
  - `th`/`td`: `scope`, `colspan`, `rowspan`  
  - `blockquote`: `cite`  

---

## ðŸ“› Name Origin

Why "Treebark"?  
Itâ€™s a blend of **trees** (for tree-structured data), **handlebars** (for templating), and **Markup/Markdown** (the content format).
