<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treebark Button Tag Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .demo-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background-color: #138496;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
            min-height: 50px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Treebark Button Tag Demo</h1>
        <p>This demo showcases the new button tag feature with click handlers and data payloads.</p>
        
        <div class="demo-section">
            <h2>Demo Buttons</h2>
            <div id="button-container"></div>
        </div>

        <div class="demo-section">
            <h2>Event Log</h2>
            <div id="output">Waiting for button clicks...</div>
        </div>

        <div class="demo-section">
            <h2>Template Code</h2>
            <div class="code-block"><code>{
  template: {
    div: {
      class: "button-group",
      $children: [
        {
          button: {
            class: "btn-primary",
            type: "button",
            "data-payload": JSON.stringify({ action: "save", id: 1 }),
            $onClick: (event, payload) => {
              logEvent("Save Button", payload);
            },
            $children: ["üíæ Save"]
          }
        },
        {
          button: {
            class: "btn-danger",
            type: "button",
            "data-payload": JSON.stringify({ action: "delete", id: 2 }),
            $onClick: (event, payload) => {
              logEvent("Delete Button", payload);
            },
            $children: ["üóëÔ∏è Delete"]
          }
        },
        {
          button: {
            class: "btn-success",
            type: "button",
            "data-payload": JSON.stringify({ action: "submit", formId: "form-1" }),
            $onClick: (event, payload) => {
              logEvent("Submit Button", payload);
            },
            $children: ["‚úÖ Submit"]
          }
        },
        {
          button: {
            class: "btn-info",
            type: "button",
            $onClick: (event, payload) => {
              logEvent("Info Button (no payload)", payload);
            },
            $children: ["‚ÑπÔ∏è Info (no payload)"]
          }
        }
      ]
    }
  }
}</code></div>
        </div>
    </div>

    <script type="module">
        // For the demo, we'll use the DOM renderer directly with a simple implementation
        // In a real application, you would import from the treebark package
        
        // Import treebark (this would work if we had a DOM browser build)
        // For now, we'll demonstrate the concept with native DOM manipulation
        
        const output = document.getElementById('output');
        const buttonContainer = document.getElementById('button-container');

        function logEvent(buttonName, payload) {
            const timestamp = new Date().toLocaleTimeString();
            const message = `[${timestamp}] ${buttonName} clicked\nPayload: ${JSON.stringify(payload, null, 2)}\n\n`;
            output.textContent = message + output.textContent;
        }

        // Helper function to safely parse JSON from data-payload attribute
        // Matches the error handling in the actual Treebark DOM renderer
        function parsePayload(element) {
            const payloadAttr = element.getAttribute('data-payload');
            if (!payloadAttr) {
                return undefined;
            }
            
            try {
                return JSON.parse(payloadAttr);
            } catch (e) {
                // If parsing fails, return the raw string value
                return payloadAttr;
            }
        }

        // Create buttons manually to demonstrate the concept
        // In a real app, these would be created using renderToDOM from treebark
        
        const buttonGroup = document.createElement('div');
        buttonGroup.className = 'button-group';

        // Save button
        const saveBtn = document.createElement('button');
        saveBtn.className = 'btn-primary';
        saveBtn.type = 'button';
        saveBtn.setAttribute('data-payload', JSON.stringify({ action: "save", id: 1 }));
        saveBtn.innerHTML = 'üíæ Save';
        saveBtn.addEventListener('click', (event) => {
            logEvent("Save Button", parsePayload(saveBtn));
        });
        buttonGroup.appendChild(saveBtn);

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn-danger';
        deleteBtn.type = 'button';
        deleteBtn.setAttribute('data-payload', JSON.stringify({ action: "delete", id: 2 }));
        deleteBtn.innerHTML = 'üóëÔ∏è Delete';
        deleteBtn.addEventListener('click', (event) => {
            logEvent("Delete Button", parsePayload(deleteBtn));
        });
        buttonGroup.appendChild(deleteBtn);

        // Submit button
        const submitBtn = document.createElement('button');
        submitBtn.className = 'btn-success';
        submitBtn.type = 'button';
        submitBtn.setAttribute('data-payload', JSON.stringify({ action: "submit", formId: "form-1" }));
        submitBtn.innerHTML = '‚úÖ Submit';
        submitBtn.addEventListener('click', (event) => {
            logEvent("Submit Button", parsePayload(submitBtn));
        });
        buttonGroup.appendChild(submitBtn);

        // Info button (no payload)
        const infoBtn = document.createElement('button');
        infoBtn.className = 'btn-info';
        infoBtn.type = 'button';
        infoBtn.innerHTML = '‚ÑπÔ∏è Info (no payload)';
        infoBtn.addEventListener('click', (event) => {
            logEvent("Info Button (no payload)", undefined);
        });
        buttonGroup.appendChild(infoBtn);

        buttonContainer.appendChild(buttonGroup);

        // Add a note explaining this is a manual demo
        const note = document.createElement('p');
        note.style.cssText = 'margin-top: 10px; font-size: 12px; color: #666;';
        note.textContent = "üìù Note: This demo uses native DOM APIs. With Treebark's renderToDOM, the buttons above would be created automatically from the template shown below.";
        buttonContainer.appendChild(note);

        console.log('Button demo loaded successfully!');
    </script>
</body>
</html>
